<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.joeun.mapper.ProductMapper">

    <insert id="addProduct" parameterType="com.joeun.dto.ProductDto">
        insert into product
        (product_id, product_name, product_condition,
         product_price,
         product_description, img1,
         img2, img3, img4, product_category_id)
        values (#{productId},
                #{productName},
                #{productCondition},
                #{productPrice},
                #{productDescription},
                #{img1},
                #{img2},
                #{img3},
                #{img4},
                #{productCategoryId})
    </insert>

    <insert id="addCategory"
            parameterType="com.joeun.dto.ProductCategoryDto">
        insert into product_category(product_category_name)
            value (
            #{productCategoryName}
            )
    </insert>

    <select id="findAllProduct"
            resultType="com.joeun.dto.ProductDto">
        SELECT *
        FROM product
    </select>


    <select id="findAllCategory"
            resultType="com.joeun.dto.ProductCategoryDto">
        select *
        from product_category
    </select>

	<!-- 상품 전체 조회 -->
	<select id="findAllProductsPaging">
		SELECT *
		FROM
		product
		LIMIT #{param2} OFFSET #{param1}
	</select>
	<!-- 상품 전체 가격순 조회 -->
	<select id="findAllProductsPrice">
		SELECT *
		FROM
		product order by product_price
		LIMIT #{param2} OFFSET #{param1}
	</select>
	
	<!-- 상품 검색 조회 -->
	<select id="findProductsByKeywordPaging">
		SELECT *
		FROM
		product
		WHERE
		product_name LIKE CONCAT('%', #{keyword}, '%')
		LIMIT #{offset}, #{size} 
	</select>
	
		<!-- 상품 검색 가격순 조회 -->
	<select id="findProductsByKeywordPrice">
		SELECT *
		FROM
		product
		WHERE
		product_name LIKE CONCAT('%', #{keyword}, '%')
		order by product_price
		LIMIT #{offset}, #{size}
	</select>

    <!-- 검색된 상품 수 조회 -->
    <select id="countProductsByKeyword" resultType="int">
        SELECT COUNT(*)
        FROM product
        WHERE product_name LIKE CONCAT('%', #{keyword}, '%')
    </select>

    <select id="findAllProductId" resultType="int">
        select product_id
        from product
    </select>

    <select id="findProductById" resultType="com.joeun.dto.ProductDto">
        select *
        from product
        where product_id = #{productId}
    </select>

    <update id="updateProduct" parameterType="com.joeun.dto.ProductDto">
        UPDATE product
        SET product_name        = #{productName},
            product_condition   = #{productCondition},
            product_price       = #{productPrice},
            product_description = #{productDescription},
            img1                = #{img1},
            img2                = #{img2},
            img3                = #{img3},
            img4                = #{img4},
            product_category_id = #{productCategoryId}
        WHERE product_id = #{productId}
    </update>

</mapper>